# Map

##  Определение

Map - это тип данных, позволяющий получить значения по ключу.

## Ключи map

Ключи в map могут быть любые сравниваемые типы (простые типы, каналы, массивы)

Slice, map, func - не могут быть ключами!

## Требования к хэш-функции

1. Вставка O(1)
2. Удаление O(1)
3. Поиск O(1)

## Структура slice

Map - это просто указатель на структуру hmap

```
type hmap struct {
	count      int // размер
	B          uint8  // количество бакетов (log для ускорения вычислений)
	buckets    unsafe.Pointer // указатель на бакеты
}
```

## Иницилизация

```
m := make(map[key_type]value_type)
m := new(map[key_type]value_type)
var m map[key_type]value_type
m := map[key_type]value_type{key1: val1, key2: val2}
```

При создании среза нужно выставлять большой cap, чтобы избежать новых аллокаций и копирований

## Эвакуация данных (переполнение в бакете)

В каждом бакете находится max 8 значений. Если нужно положить 9 значение, то возникает переполнение бакетов

Ссылка на новый бакет, сохраняется в старом бакете.

Эвакуация - создается новый список бакетов, который в два раза больше. Это происходит в тот момент, когда процент заполнения всех бакетов равняется 6.5%.

Чтобы избежать эвакуацию, нужно выделять память заранее.

## Почему нельзя взять указатель на элемент map?

Это связанно с эвакуацией данных. Если мы взяли адресс значения, а map выросла и произошла эвакуация данных, старые данные удалились и наш указатель указывает на несуществующие данные.
